<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <style type="text/css">
        body {
            color: #8b8b8b;
            font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
        }

        .tablecompl {
            border-spacing: 0px;
        }

        .tablecompl td,
        .tablecompl tr {
            border-bottom: 1px solid #ececec;
        }

        .tdG {
            /*td de color gris*/
            background-color: #eeeeee;
            padding: 8px;
        }

        .tdB {
            /*td de color Blanco*/
            background-color: #fff;
            padding: 1px;
        }

        .tdV {
            /*td de  color verde*/
            background-color: #3c8dbc;
            color: #fff;
            padding: 8px;
        }

        .tdA {
            /*td de  color Amarillo*/
            background-color: #fcf7af;
            padding: 8px;
        }

        .tdN {
            /*td de  color Naranja*/
            background-color: #ff9400;
            color: #fff;
            text-align: center;
        }

        .Med90 {
            width: 100%;
            font-size: 16px;
            text-align: center;
        }

        .nombreJG {
            width: 100%;
        }

        .PuntosC {
            color: red;
        }

        .PuntosF {
            color: green;
        }

        .rotate1 {
            display: inline-block;
            filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
            -webkit-transform: rotate(270deg);
            -ms-transform: rotate(270deg);
            transform: rotate(270deg);
        }

        .rotate2 {
            display: inline-block;
            filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
            -webkit-transform: rotate(-270deg);
            -ms-transform: rotate(-270deg);
            transform: rotate(-270deg);
        }


        .celdas:nth-child(odd) {
            background: #f9f9f9;
        }

        input {
            border: 0px solid #e8e8e8;
            background: transparent;
        }

        ::placeholder {
            color: #b7b7b7;
            opacity: 1;
        }

        :-ms-input-placeholder {
            color: #b7b7b7;
        }

        ::-ms-input-placeholder {
            color: #b7b7b7;
        }

        .px-2 {
            padding-right: 0.5rem !important;
            padding-left: 0.5rem !important;
        }

        .Posicion {
            background-color: #ff9400;
            color: #fff;
            text-align: center;
            padding: 12px;
            margin-left: 20px;
        }

        .Posicionnombre {
            background-color: #dde0e2;
            color: #808080;
            padding: 12px;
            line-height: 30px;
        }

        .text-mesa {
            color: #ff9400;
        }

        select {
            border: 0px;
            background: transparent;
        }

        select:focus,
        select:hover {
            border: 0px;
        }

        /* ultimos estilos para los numeros y mesas */

        .container-table-player {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 70px;
            border-radius: 5px;
            padding: 0;
            border: 1px solid black;
            margin: 10px;
        }

        .item-number {
            grid-column: 1;
            background: #ff9400;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .item-table {
            grid-column: 2;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
        }

        /* ultimos estilos para los numeros y mesas */
    </style>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Document</title>
</head>

<body>

    <select id="select-ronda">
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
    </select>


    <div>
        <div>
            <div>
                <table id="tabla-super-polla" data-ronda-en-juego="0">
                    <thead>
                        <tr id="ronda-juego">
                            <th colspan="4"></th>
                            <th colspan="2" class="tdV">Juego 1</th>
                            <th colspan="2" class="tdV">Juego 2</th>
                            <th colspan="2" class="tdV">Juego 3</th>
                            <th colspan="2" class="tdV">Juego 4</th>
                            <th colspan="2" class="tdV last-ronda-juego">Juego 5</th>
                            <th colspan="2"></th>
                        </tr>
                        <tr id="ronda-Puntos">
                            <th class="tdG">Pos.</th>
                            <th class="tdG">Mesa</th>
                            <th class="tdG">Nombre</th>
                            <th class="tdG">No.</th>
                            <th class="tdG" title="Puntos a Fabor.">F</th>
                            <th class="tdG" title="Puntos en Contra.">C</th>
                            <th class="tdG" title="Puntos a Fabor.">F</th>
                            <th class="tdG" title="Puntos en Contra.">C</th>
                            <th class="tdG" title="Puntos a Fabor.">F</th>
                            <th class="tdG" title="Puntos en Contra.">C</th>
                            <th class="tdG" title="Puntos a Fabor.">F</th>
                            <th class="tdG" title="Puntos en Contra.">C</th>
                            <th class="tdG" title="Puntos a Fabor.">F</th>
                            <th class="tdG" title="Puntos en Contra.">C</th>
                            <th class="tdV">J/G</th>
                            <th id="head-avg" class="tdG">AVG</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="row-game">
                            <td class="tdN">Pos</td>
                            <td class="tdG">Mesa</td>
                            <td class="tdG"><select>
                                    <option>Andres</option>
                                    <option>Jose</option>
                                    <option>Maria</option>
                                    <option>Pedro</option>
                                </select></td>
                            <td>No.</td>
                            <td data-ronda="1" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="1" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="2" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td data-ronda="1" data-puntos="F">
                            <td data-ronda="2" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td data-ronda="1" data-puntos="C">
                            <td data-ronda="3" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="3" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="4" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="4" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="5" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="5" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td>1</td>
                            <td>4</td>
                        </tr>
                        <tr class="row-game">
                            <td class="tdN">Pos</td>
                            <td class="tdG">Mesa</td>
                            <td class="tdG"><select>
                                    <option>Andres</option>
                                    <option>Jose</option>
                                    <option>Maria</option>
                                    <option>Pedro</option>
                                </select></td>
                            <td>No.</td>
                            <td data-ronda="1" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td data-ronda="1" data-puntos="F">
                            <td data-ronda="1" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td data-ronda="1" data-puntos="C">
                            <td data-ronda="2" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="2" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="3" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="3" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="4" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="4" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="5" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="5" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td>2</td>
                            <td>3</td>
                        </tr>
                        <tr class="row-game">
                            <td class="tdN">Pos</td>
                            <td class="tdG">Mesa</td>
                            <td class="tdG"><select>
                                    <option>Andres</option>
                                    <option>Jose</option>
                                    <option>Maria</option>
                                    <option>Pedro</option>
                                </select></td>
                            <td>No.</td>
                            <td data-ronda="1" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td data-ronda="1" data-puntos="F">
                            <td data-ronda="1" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td data-ronda="5" data-puntos="C">
                            <td data-ronda="2" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="2" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="3" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="3" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="4" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="4" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="5" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="5" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td>1</td>
                            <td>4.1</td>
                        </tr>
                        <tr class="row-game">
                            <td class="tdN">Pos</td>
                            <td class="tdG">Mesa</td>
                            <td class="tdG"><select>
                                    <option>Andres</option>
                                    <option>Jose</option>
                                    <option>Maria</option>
                                    <option>Pedro</option>
                                </select></td>
                            <td>No.</td>
                            <td data-ronda="1" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td data-ronda="1" data-puntos="F">
                            <td data-ronda="1" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td data-ronda="5" data-puntos="C">
                            <td data-ronda="2" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="2" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="3" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="3" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="4" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="4" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td data-ronda="5" data-puntos="F"><input type="number" style="width: 100%; color: green;"
                                    disabled /></td>
                            <td data-ronda="5" data-puntos="C"><input type="number" style="width: 100%; color: red;"
                                    disabled /></td>
                            <td>0</td>
                            <td>1</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <button id="button-add" type="button" class="btn btn-success">Success 1</button>
        <button id="button-mix" type="button" class="btn btn-prymary">Mezclar 2</button>
        <button id="button-start" type="button" class="btn btn-prymary">Iniciar Ronda 3</button>

        <button id="button-order" type="button" class="btn btn-warning">Order 4</button>

        <script>

            $(document).on('click', '#button-order', function (event) {

                let juego = $("#tabla-super-polla")[0].dataset.rondaEnJuego
                let cell = 2 * juego + 2

                let row = $('table#tabla-super-polla tbody tr:nth-child( 4n + 1 )')            
                $.each(row, function (index, value) {
                    $(this)[0].cells[cell].children[0].disabled = true
                    $(this)[0].cells[cell + 1].children[0].disabled = true       
                    $(this)[0].classList.remove("line-writer")             
                    console.log($(this)[0].cells[cell].children[0].classList.remove("input-puntos"))
                    console.log($(this)[0].cells[cell + 1].children[0].classList.remove("input-puntos"))
                });


                let table = $('table#tabla-super-polla')

                let headAvg = document.getElementById("head-avg");

                let avg = $('table#tabla-super-polla thead #ronda-Puntos th').index(headAvg)

                var rowsJueGan = table.find('tr:gt(1)').toArray().sort(comparer(avg - 1))
                rowsJueGan = rowsJueGan.reverse()
                var rowsJueGanCopy = [...rowsJueGan]
                var rowsAvg = rowsJueGanCopy.sort(comparerModificado(avg))

                for (var i = 0; i < rowsAvg.length; i++) {
                    table.append(rowsAvg[i])
                }


            })

            $(document).on('change', '#select-ronda', function (event) {
                if (event.target.value) {
                    for (var i = 6; i <= event.target.value; i++) {
                        let count = $("#ronda-Puntos").children().length - 2

                        const elementRow = `<th colspan="2" class="tdV last-ronda-juego">Juego ${i}</th>`
                        $('.last-ronda-juego').last().after(elementRow)

                        const elementRowGame = `<th class="tdG" title="Puntos a Fabor.">F</th><th class="tdG" title="Puntos en Contra.">C</th>`
                        $("#ronda-Puntos th:nth-child(" + count + ")").after(elementRowGame)


                        $.each($(".row-game td:nth-child(" + count + ")"), function (index, value) {
                            const elementRowPoint = `<td data-ronda="${i}" data-puntos="F"><input type="number" style="width: 100%; color: green;" disabled></td><td data-ronda="${i}" data-puntos="C"><input type="number" style="width: 100%; color: red;" disabled></td>`
                            $(this).after(elementRowPoint)
                        });
                    }
                }
            })

            $(document).on('click', '#button-start', function (event) {

                $("#tabla-super-polla")[0].dataset.rondaEnJuego = parseInt($("#tabla-super-polla")[0].dataset.rondaEnJuego) + 1
                let juego = $("#tabla-super-polla")[0].dataset.rondaEnJuego
                let cell = 2 * juego + 2

                let row = $('table#tabla-super-polla tbody tr:nth-child( 4n + 1 )')

                $.each(row, function (index, value) {
                    //console.log($(this)[0].cells[4].dataset.ronda)
                    $(this)[0].cells[cell].children[0].disabled = false
                    $(this)[0].cells[cell + 1].children[0].disabled = false
                    $(this)[0].classList.add("line-writer")
                    console.log($(this)[0].cells[cell].children[0].classList.add("input-puntos"))
                    console.log($(this)[0].cells[cell + 1].children[0].classList.add("input-puntos"))
                });
                $('table#tabla-super-polla tbody tr:nth-child( 1 )')[0].cells[cell].children[0].focus()
            })

            $(document).on('focusout', '.input-puntos', function (event) {

                let punto = $(event.target.parentElement)[0].dataset.puntos
                let puntuacion = event.target.value
                let juego = $("#tabla-super-polla")[0].dataset.rondaEnJuego
                let cell = 2 * juego + 2
                let impar = true
                punto == "F" ? (impar = true) : (impar = false)

                $.each($(event.target.parentElement.parentElement).nextUntil(".line-writer"), function (index, value) {

                    (impar) ? cellNew = cell + 1 : cellNew = cell
                    impar = !impar
                    $(value).children()[cellNew].children[0].value = event.target.value
                    //console.log($(value).children()[cell + 1].children[0])

                });
            })


            $(document).on('click', '#button-add', function (event) {

                let line = `<tr class="row-game">
                            <td class="tdN">Pos</td>
                            <td class="tdG">Mesa</td>
                            <td class="tdG">Nombre</td>
                            <td>No.</td>
                            <td data-ronda="1" data-puntos="F"><input type="number" style="width: 100%; color: green;" disabled/></td>
                            <td data-ronda="1" data-puntos="C"><input type="number" style="width: 100%; color: red;" disabled/></td>
                            <td data-ronda="2" data-puntos="F"><input type="number" style="width: 100%; color: green;" disabled/></td>
                            <td data-ronda="2" data-puntos="C"><input type="number" style="width: 100%; color: red;" disabled/></td>
                            <td data-ronda="3" data-puntos="F"><input type="number" style="width: 100%; color: green;" disabled/></td>
                            <td data-ronda="3" data-puntos="C"><input type="number" style="width: 100%; color: red;" disabled/></td>
                            <td data-ronda="4" data-puntos="F"><input type="number" style="width: 100%; color: green;" disabled/></td>
                            <td data-ronda="4" data-puntos="C"><input type="number" style="width: 100%; color: red;" disabled/></td>
                            <td data-ronda="5" data-puntos="F"><input type="number" style="width: 100%; color: green;" disabled/></td>
                            <td data-ronda="5" data-puntos="C"><input type="number" style="width: 100%; color: red;" disabled/></td>
                            `;


                if ($("#select-ronda").val()) {
                    for (var i = 6; i <= $("#select-ronda").val(); i++) {
                        line += `<td data-ronda="${i}" data-puntos="F"><input type="number" style="width: 100%; color: green;" disabled/></td>
                                 <td data-ronda="${i}" data-puntos="C"><input type="number" style="width: 100%; color: red;" disabled/></td>`
                    }
                }
                line += `<td>1</td>
                            <td>11</td>
                        </tr>`

                $('#tabla-super-polla tr:last').after(line.repeat(4))
            })

            function comparer(index) {
                return function (a, b) {
                    var valA = getCellValue(a, index),
                        valB = getCellValue(b, index),
                        valC = getCellValue(a, index + 1),
                        valD = getCellValue(b, index + 1)
                    //console.log(valA, valB, valC, valD)
                    return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.localeCompare(valB)
                }
            }

            function comparerModificado(index) {
                return function (a, b) {
                    var valA = getCellValue(a, index),
                        valB = getCellValue(b, index),
                        valC = getCellValue(a, index - 1),
                        valD = getCellValue(b, index - 1)
                    //console.log(valA, valB, valC, valD)
                    if (valC === valD) {
                        return $.isNumeric(valA) && $.isNumeric(valB) ? valB - valA : valA.localeCompare(valB)
                    }
                    return 0;
                }
            }

            function getCellValue(row, index) {
                return $(row).children('td').eq(index).html()
            }

            $(document).on('click', '#button-mix', function (event) {
                let table = $('table#tabla-super-polla tbody')[0]

                //1. get all rows
                let rowsCollection = $('table#tabla-super-polla tbody tr')

                //2. convert to array
                let rows = Array.from(rowsCollection)

                //3. shuffle
                shuffleArray(rows);

                //4. add back to the DOM
                for (const row of rows) {
                    table.appendChild(row);
                }
            })
            function shuffleArray(array) {
                for (var i = array.length - 1; i > 0; i--) {
                    var j = Math.floor(Math.random() * (i + 1));
                    var temp = array[i];
                    array[i] = array[j];
                    array[j] = temp;
                }
            }


        </script>

</body>

</html>